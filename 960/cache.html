<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SHAKOM PS - Cache</title>
    <script src="./bundle.js"></script>
    <style>
      html,body{height:100%;margin:0}
      body {
        /* centered background that scrolls with page */
        background: url('./imgg.jpg') no-repeat center center;
        background-size: cover;
        background-color: #252526; /* fallback color if image fails */
        font-family: sans-serif;
      }
      h2 {
        margin-bottom: 20px;
        color: #ffffff;
        text-align: center;
        padding-top: 20px;
      }
      #console {
        font-family: monospace;
        background-color: rgba(30,30,30,0.85);
        color: #cccccc;
        border: 1px solid #3c3c3c;
        padding: 12px;
        border-radius: 6px;
        margin: 20px auto;
        text-align: left;
        max-width: 900px;
        white-space: pre-wrap;
      }
      /* Hide the button on cached page too */
      #jailbreakBtn { display: none; }
      footer {
        margin-top: 30px;
        font-size: 14px;
        color: #888;
        text-align: center;
      }
      a { color: #aaa; }
      .wrap { max-width: 960px; margin: 0 auto; padding: 16px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h2>SHAKOM PS (Cache)</h2>

      <div>
        <button id="jailbreakBtn">اضغط هنا لتفعيل التعديل</button>
      </div>
      <pre id="console"></pre>

      <footer>
        <p>You are viewing the cached page.</p>
        <p><a href="index.html">Return to live page</a></p>
      </footer>
    </div>
  </body>
  <script>
    // Logging utility
    const outputConsole = document.getElementById("console");
    window.log = (msg, color="#cccccc") => { outputConsole.innerHTML += `<span style="color:${color}">${msg}</span><br>`; };

    // Auto-run exploit when DOM is ready (same logic as index.html)
    document.addEventListener('DOMContentLoaded', () => {
      outputConsole.textContent = "";
      try {
        if (typeof doJBwithPSFreeLapseExploit === 'function') {
          window.log('Starting automatic exploit (cached page)...', '#aaffaa');
          doJBwithPSFreeLapseExploit();
        } else {
          window.log('Exploit function not available on load (cached page). Waiting for bundle...', 'orange');
          let attempts = 0;
          const maxAttempts = 20;
          const id = setInterval(() => {
            attempts++;
            if (typeof doJBwithPSFreeLapseExploit === 'function') {
              clearInterval(id);
              window.log('Exploit function found — running now.', '#aaffaa');
              try { doJBwithPSFreeLapseExploit(); } catch (e) { window.log('Error running exploit: ' + e, 'red'); }
            } else if (attempts >= maxAttempts) {
              clearInterval(id);
              window.log('Exploit function did not appear after waiting.', 'orange');
            }
          }, 250);
        }
      } catch (error) {
        window.log("An error occured during exploit: " + error, "red");
      }
    });
  </script>
</html>
