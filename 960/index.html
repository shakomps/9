<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SHAKOM PS</title>
    <script src="./bundle.js"></script>
    <style>
       html,body{height:100%;margin:0}
       body {
         background: url('./imgg.jpg') no-repeat center center;
         background-size: cover;
         background-color: #252526; /* fallback color if image fails */
         font-family: sans-serif;
       }
      h2 {
        margin-bottom: 20px;
        color: #ffffff;
        text-align: center;
        padding-top: 20px;
      }
      #console {
        font-family: monospace;
        background-color: rgba(30,30,30,0.85);
        color: #cccccc;
        border: 1px solid #3c3c3c;
        padding: 12px;
        border-radius: 6px;
        margin: 20px auto;
        text-align: left;
        max-width: 900px;
        white-space: pre-wrap;
      }
      /* Hide the button since we auto-run on load */
      #jailbreakBtn { display: none; }
      footer {
        margin-top: 30px;
        font-size: 14px;
        color: #888;
        text-align: center;
      }
    </style>
    <script>
      if ((window.applicationCache && (window.applicationCache.status == '0' || window.applicationCache.status == '3'))) { // 0: UNCACHED, 3: IDLE
        window.location.replace("cache.html");
      }
    </script>
  </head>
  <body>
    <h2>SHAKOM PS</h2>

    <!-- Button intentionally hidden; kept in DOM in case you want to show it later -->
    <div>
      <button id="jailbreakBtn">اضغط هنا لتفعيل التعديل</button>
    </div>

    <pre id="console"></pre>

  </body>
  <script>
    // Logging utility
    const outputConsole = document.getElementById("console");
    window.log = (msg, color="#cccccc") => { outputConsole.innerHTML += `<span style="color:${color}">${msg}</span><br>`; };

    // Global error handlers
    addEventListener('unhandledrejection', event => {
      const reason = event.reason;
      window.log('Unhandled rejection: ' + String(reason), "red");
    });
    addEventListener('error', event => {
      const reason = event.error || event.message;
      window.log('Unhandled error: ' + String(reason), "red");
      return true;
    });

    // Auto-run exploit when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      outputConsole.textContent = ""; // Clear console log
      try {
        if (typeof doJBwithPSFreeLapseExploit === 'function') {
          window.log('Starting automatic exploit...', '#aaffaa');
          doJBwithPSFreeLapseExploit();
        } else {
          window.log('Exploit function not available on load. Waiting for bundle to initialize...', 'orange');
          // Poll for the function (250ms interval, ~5s total)
          let attempts = 0;
          const maxAttempts = 20;
          const id = setInterval(() => {
            attempts++;
            if (typeof doJBwithPSFreeLapseExploit === 'function') {
              clearInterval(id);
              window.log('Exploit function found — running now.', '#aaffaa');
              try { doJBwithPSFreeLapseExploit(); } catch (e) { window.log('Error running exploit: ' + e, 'red'); }
            } else if (attempts >= maxAttempts) {
              clearInterval(id);
              window.log('Exploit function did not appear after waiting.', 'orange');
            }
          }, 250);
        }
      } catch (error) {
        window.log("An error occured during exploit: " + error, "red");
      }
    });
  </script>
</html>
